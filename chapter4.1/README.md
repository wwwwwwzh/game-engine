This is pure optimization chapter. First webgpu is used to replace webgl in three.js. The only change is updated npm three.js version and vite config and import from three/webgpu instead of three.

The code at chapter 4 was becoming very hard to read due to the many cross references between classes. For example, Renderer references Scene and synchronizes Scene's game objects' transforms and meshes. This is largely because at first, I wanted a realistic game engine code and overlooking the complexities that's already addressed in three.js. So lots of codes are mitigating synchronizations between the parrallel realities of three and the code here. For example, scene needs to sync threeScene, renderer threeRenderer, and game objects, meshRenderer and Transform all needs to somehow sync three's object3D. I drew a function call graph by hand and eventually figured out what's happening and asked claude to refactor the code, with the principal that each custom class here should manage its own three counterpart, and that what's in object3D should be used directly with Transform and MeshRenderer and potentially many future components being merely wrappers of functions object3D already exposes. The plan and the summary are in chapter4.1/REFACTORING_PLAN.md and chapter4.1/REFACTORING_COMPLETE.md 